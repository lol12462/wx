-- Локальный скрипт для подсветки игроков через стены

local player = game.Players.LocalPlayer
local players = game:GetService("Players")
local runService = game:GetService("RunService")
local workspace = game:GetService("Workspace")

local highlightColor = Color3.fromRGB(0, 255, 0) -- Цвет подсветки (зелёный)

-- Функция для создания подсветки вокруг головы игрока
local function createGlowEffect(targetPlayer)
    -- Проверяем, есть ли у игрока персонаж и часть "Head"
    if targetPlayer.Character and targetPlayer.Character:FindFirstChild("Head") then
        local character = targetPlayer.Character
        local head = character:FindFirstChild("Head")
        
        -- Проверка, чтобы не создавать подсветку дважды
        local existingGlow = character:FindFirstChild("GlowBox")
        if existingGlow then
            return
        end

        -- Создаём BillboardGui для подсветки
        local glowGui = Instance.new("BillboardGui")
        glowGui.Name = "GlowBox"
        glowGui.Parent = character
        glowGui.Adornee = head  -- Привязываем подсветку к голове
        glowGui.Size = UDim2.new(0, 10, 0, 10)  -- Размер подсветки (квадрат)
        glowGui.StudsOffset = Vector3.new(0, 0, 0)  -- Подсветка на уровне головы

        -- Настройка рамки
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0, 10, 0, 10)  -- Размер квадратика (площадь 10x10)
        frame.BackgroundTransparency = 0.5
        frame.BackgroundColor3 = highlightColor
        frame.BorderSizePixel = 0
        frame.Parent = glowGui
        
        -- Настройка рамки для подсветки
        local outline = Instance.new("UIStroke")
        outline.Thickness = 2
        outline.Color = highlightColor
        outline.Parent = frame

        -- Включение всегда на переднем плане
        glowGui.AlwaysOnTop = true
    end
end

-- Функция для удаления подсветки
local function removeGlowEffect(targetPlayer)
    if targetPlayer.Character then
        local glowBox = targetPlayer.Character:FindFirstChild("GlowBox")
        if glowBox then
            glowBox:Destroy()
        end
    end
end

-- Обновление подсветки для всех игроков
local function updateGlowEffects()
    for _, targetPlayer in pairs(players:GetPlayers()) do
        if targetPlayer ~= player then
            createGlowEffect(targetPlayer)
        end
    end
end

-- Обработчик появления нового игрока
players.PlayerAdded:Connect(function(newPlayer)
    newPlayer.CharacterAdded:Connect(function()
        createGlowEffect(newPlayer)
    end)
end)

-- Обработчик удаления игрока
players.PlayerRemoving:Connect(function(leavingPlayer)
    removeGlowEffect(leavingPlayer)
end)

-- Постоянное обновление подсветки
runService.Heartbeat:Connect(updateGlowEffects)

-- Применяем подсветку ко всем игрокам при старте
updateGlowEffects()
