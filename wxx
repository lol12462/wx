-- Локальный скрипт для подсветки игроков через стены

local player = game.Players.LocalPlayer
local players = game:GetService("Players")
local runService = game:GetService("RunService")

local highlightColor = Color3.fromRGB(0, 255, 0) -- Цвет подсветки (зелёный)

-- Функция для создания подсветки вокруг всего игрока
local function createGlowEffect(targetPlayer)
    -- Проверяем, есть ли у игрока персонаж и часть "HumanoidRootPart"
    if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local character = targetPlayer.Character
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        
        -- Проверка, чтобы не создавать подсветку дважды
        local existingGlow = character:FindFirstChild("GlowBox")
        if existingGlow then
            return
        end

        -- Получаем размеры всей модели персонажа
        local characterSize = character:GetExtentsSize()
        
        -- Исправление размера рамки, чтобы она не была слишком большой или маленькой
        local adjustedSize = Vector3.new(
            math.min(characterSize.X * 1.1, 6),  -- Ограничиваем максимальный размер по оси X
            math.min(characterSize.Y * 1.1, 6),  -- Ограничиваем максимальный размер по оси Y
            math.min(characterSize.Z * 1.1, 6)   -- Ограничиваем максимальный размер по оси Z
        )

        -- Создаём BoxHandleAdornment для всей модели
        local glowBox = Instance.new("BoxHandleAdornment")
        glowBox.Name = "GlowBox"
        glowBox.Parent = character
        glowBox.Adornee = humanoidRootPart
        glowBox.Size = adjustedSize  -- Используем откорректированные размеры
        glowBox.Transparency = 0.5
        glowBox.Color3 = highlightColor
        glowBox.OutlineColor3 = highlightColor
        glowBox.OutlineTransparency = 0
        glowBox.ZIndex = 100 -- Обеспечиваем, чтобы был поверх
        glowBox.AlwaysOnTop = true
    end
end

-- Функция для удаления подсветки
local function removeGlowEffect(targetPlayer)
    if targetPlayer.Character then
        local glowBox = targetPlayer.Character:FindFirstChild("GlowBox")
        if glowBox then
            glowBox:Destroy()
        end
    end
end

-- Обновление подсветки для всех игроков
local function updateGlowEffects()
    for _, targetPlayer in pairs(players:GetPlayers()) do
        if targetPlayer ~= player then
            createGlowEffect(targetPlayer)
        end
    end
end

-- Обработчик появления нового игрока
players.PlayerAdded:Connect(function(newPlayer)
    newPlayer.CharacterAdded:Connect(function()
        createGlowEffect(newPlayer)
    end)
end)

-- Обработчик удаления игрока
players.PlayerRemoving:Connect(function(leavingPlayer)
    removeGlowEffect(leavingPlayer)
end)

-- Постоянное обновление подсветки
runService.Heartbeat:Connect(updateGlowEffects)

-- Применяем подсветку ко всем игрокам при старте
updateGlowEffects()
